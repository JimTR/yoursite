var ASB=(function(a){function initialize($super,container,url,options){$super(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||30);this.decay=this.options.decay=(this.options.decay||1);this.updater={};this.container=$(container).down('tbody');this.url=url;this.phpTimeDiff=Math.floor(this.options.parameters.dateline-(new Date().getTime()/1000));this.start();}
function start(){this.options.onComplete=this.updateComplete.bind(this);this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency);}
function stop(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments);}
function updateComplete(response){if(response.responseText&&response.responseText!='nochange'){this.decay=this.options.decay;this.container.update(response.responseText);}else{this.decay=this.decay*this.options.decay;}
this.options.parameters.dateline=Math.floor(new Date().getTime()/1000+this.phpTimeDiff);this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency);}
function onTimerEvent(){if(this.container.offsetWidth<=0&&this.container.offsetHeight<=0){this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency);return;}
this.updater=new Ajax.Request(this.url,this.options);}
SideboxUpdater=Class.create(Ajax.Base,{initialize:initialize,start:start,stop:stop,updateComplete:updateComplete,onTimerEvent:onTimerEvent,});function buildUpdaters(updaters,widths,script){if(updaters.length==0){return;}
var this_id='',width=0;for(var i=0;i<updaters.length;i++){this_id=updaters[i].addon+'_main_'+updaters[i].id;if(!$(this_id)){continue;}
width=widths.left;if(updaters[i].position){width=widths.right;}
new SideboxUpdater(this_id,'xmlhttp.php',{parameters:{action:'asb',id:updaters[i].id,addon:updaters[i].addon,dateline:updaters[i].dateline,width:width,script:script,},method:'get',frequency:updaters[i].rate});}}
a.ajax={buildUpdaters:buildUpdaters,};return a;})(ASB||{});